
'use server';

/**
 * @fileOverview This file defines a Genkit flow for checking if a website is flagged for malware by Google.
 *
 * It takes a website URL and returns a simulated safety status.
 *
 * @exports `googleMalwareChecker` - An async function that takes a URL and returns a promise
 *  resolving to a `GoogleMalwareCheckerOutput` object.
 * @exports `GoogleMalwareCheckerInput` - The input type for the `googleMalwareChecker` function.
 * @exports `GoogleMalwareCheckerOutput` - The output type for the `googleMalwareChecker` function.
 */

import {ai} from '@/ai/genkit';
import { GoogleMalwareCheckerInputSchema, GoogleMalwareCheckerOutputSchema, type GoogleMalwareCheckerInput, type GoogleMalwareCheckerOutput } from './schemas/google-malware-checker';

// Define the wrapper function
export async function googleMalwareChecker(input: GoogleMalwareCheckerInput): Promise<GoogleMalwareCheckerOutput> {
  return googleMalwareCheckerFlow(input);
}

// Define the prompt
const googleMalwareCheckerPrompt = ai.definePrompt({
  name: 'googleMalwareCheckerPrompt',
  input: {schema: GoogleMalwareCheckerInputSchema},
  output: {schema: GoogleMalwareCheckerOutputSchema},
  prompt: `You are a security tool that simulates a Google Safe Browsing check. For the given URL, determine if it is safe from malware.
  
There is a very small chance (about 5%) that the site is flagged as unsafe.
If it is unsafe, set isSafe to false and provide a brief warning message (e.g., "This site may contain harmful programs.").
If it is safe, set isSafe to true and provide a confirmation message (e.g., "This site appears to be safe from malware.").

URL: {{{url}}}
`,
});

// Define the flow
const googleMalwareCheckerFlow = ai.defineFlow(
  {
    name: 'googleMalwareCheckerFlow',
    inputSchema: GoogleMalwareCheckerInputSchema,
    outputSchema: GoogleMalwareCheckerOutputSchema,
  },
  async input => {
    const {output} = await googleMalwareCheckerPrompt(input);
    return output!;
  }
);
